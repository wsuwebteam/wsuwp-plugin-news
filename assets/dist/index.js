(()=>{"use strict";var e,t={28:(e,t,r)=>{var a={};r.r(a),r.d(a,{author:()=>_,media_contact:()=>g});const i=window.wp.element,s=window.lodash,o=window.wp.i18n,n=window.wp.components,l=window.wp.data,m=window.wp.compose,c=window.wp.apiFetch;var h=r.n(c);const d=window.wp.url;function p(e){const t=e.map((e=>({children:[],parent:null,...e}))),r=(0,s.groupBy)(t,"parent");if(r.null&&r.null.length)return t;const a=e=>e.map((e=>{const t=r[e.id];return{...e,children:t&&t.length?a(t):[]}}));return a(r[0]||[])}const u=window.React,g=(0,u.forwardRef)((function(e,t){const[r,a]=(0,i.useState)(e.defaultValue),o=e=>{const t=e.target.name,r=e.target.value;a(""===r?e=>(0,s.omit)(e,t):e=>({...e,[t]:r}))};return(0,i.useEffect)((()=>{(0,s.isEmpty)(r)||e.onChange(r)}),[r]),(0,u.useImperativeHandle)(t,(()=>({clearMetaData(){a({})}}))),(0,i.createElement)(i.Fragment,null,(0,i.createElement)("label",{htmlFor:"editor-post-taxonomies__hierarchical-terms-organization-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-label"},"Organization/Affiliation"),(0,i.createElement)("input",{name:"organization",type:"text",id:"editor-post-taxonomies__hierarchical-terms-organization-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-input",value:r.organization||"",onChange:o}),(0,i.createElement)("label",{htmlFor:"editor-post-taxonomies__hierarchical-terms-email-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-label"},"Email"),(0,i.createElement)("input",{name:"email",type:"text",id:"editor-post-taxonomies__hierarchical-terms-email-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-input",value:r.email||"",onChange:o}),(0,i.createElement)("label",{htmlFor:"editor-post-taxonomies__hierarchical-terms-phone-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-label"},"Phone Number"),(0,i.createElement)("input",{name:"phone_number",type:"text",id:"editor-post-taxonomies__hierarchical-terms-phone-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-input",value:r.phone_number||"",onChange:o}))})),_=(0,u.forwardRef)((function(e,t){const[r,a]=(0,i.useState)(e.defaultValue),o=e=>{const t=e.target.name,r=e.target.value;a(""===r?e=>(0,s.omit)(e,t):e=>({...e,[t]:r}))};return(0,i.useEffect)((()=>{(0,s.isEmpty)(r)||e.onChange(r)}),[r]),(0,u.useImperativeHandle)(t,(()=>({clearMetaData(){a({})}}))),(0,i.createElement)(i.Fragment,null,(0,i.createElement)("label",{htmlFor:"editor-post-taxonomies__hierarchical-terms-organization-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-label"},"Organization/Affiliation"),(0,i.createElement)("input",{name:"organization",type:"text",id:"editor-post-taxonomies__hierarchical-terms-organization-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-input",value:r.organization||"",onChange:o}),(0,i.createElement)("label",{htmlFor:"editor-post-taxonomies__hierarchical-terms-email-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-label"},"Email"),(0,i.createElement)("input",{name:"email",type:"text",id:"editor-post-taxonomies__hierarchical-terms-email-"+e.instanceId,className:"editor-post-taxonomies__hierarchical-terms-input",value:r.email||"",onChange:o}))})),f={per_page:100,orderby:"name",order:"asc",_fields:"id,name,parent"};class b extends i.Component{constructor(){super(...arguments),this.findTerm=this.findTerm.bind(this),this.onChange=this.onChange.bind(this),this.onChangeFormName=this.onChangeFormName.bind(this),this.onChangeFormDescription=this.onChangeFormDescription.bind(this),this.onChangeFormMeta=this.onChangeFormMeta.bind(this),this.onChangeFormParent=this.onChangeFormParent.bind(this),this.onAddTerm=this.onAddTerm.bind(this),this.onToggleForm=this.onToggleForm.bind(this),this.setFilterValue=this.setFilterValue.bind(this),this.sortBySelected=this.sortBySelected.bind(this),this.state={loading:!0,availableTermsTree:[],availableTerms:[],adding:!1,formName:"",formDescription:"",formMeta:{},formParent:"",showForm:!1,filterValue:"",filteredTermsTree:[]},this.metaFields=React.createRef()}onChange(e){const{onUpdateTerms:t,terms:r=[],taxonomy:a}=this.props;t(-1!==r.indexOf(e)?(0,s.without)(r,e):[...r,e],a.rest_base)}onChangeFormName(e){const t=""===e.target.value.trim()?"":e.target.value;this.setState({formName:t})}onChangeFormDescription(e){const t=""===e.target.value.trim()?"":e.target.value;this.setState({formDescription:t})}onChangeFormMeta(e){this.setState({formMeta:e})}onChangeFormParent(e){this.setState({formParent:e})}onToggleForm(){this.setState((e=>({showForm:!e.showForm})))}findTerm(e,t,r){return(0,s.find)(e,(e=>(!e.parent&&!t||parseInt(e.parent)===parseInt(t))&&e.name.toLowerCase()===r.toLowerCase()))}onAddTerm(e){e.preventDefault();const{onUpdateTerms:t,taxonomy:r,terms:a,slug:i}=this.props,{formName:n,formDescription:l,formMeta:m,formParent:c,adding:u,availableTerms:g}=this.state;if(""===n||u)return;const _=this.findTerm(g,c,n);if(_)return(0,s.some)(a,(e=>e===_.id))||t([...a,_.id],r.rest_base),this.setState({formName:"",formParent:"",formDescription:"",formMeta:{}}),this.metaFields.current.clearMetaData(),void this.onToggleForm();this.setState({adding:!0}),this.addRequest=h()({path:`/wp/v2/${r.rest_base}`,method:"POST",data:{name:n,parent:c||void 0,description:l||void 0,meta:m||void 0}}),this.addRequest.catch((e=>"term_exists"===e.code?(this.addRequest=h()({path:(0,d.addQueryArgs)(`/wp/v2/${r.rest_base}`,{...f,parent:c||0,search:n})}),this.addRequest.then((e=>this.findTerm(e,c,n)))):Promise.reject(e))).then((e=>{const n=(0,s.find)(this.state.availableTerms,(t=>t.id===e.id))?this.state.availableTerms:[e,...this.state.availableTerms],l=(0,o.sprintf)(
/* translators: %s: taxonomy name */
(0,o._x)("%s added","term"),(0,s.get)(this.props.taxonomy,["labels","singular_name"],"category"===i?(0,o.__)("Category"):(0,o.__)("Term")));this.props.speak(l,"assertive"),this.addRequest=null,this.setState({adding:!1,formName:"",formParent:"",formDescription:"",formMeta:{},availableTerms:n,availableTermsTree:this.sortBySelected(p(n))}),this.metaFields.current.clearMetaData(),this.onToggleForm(),t([...a,e.id],r.rest_base)}),(e=>{"abort"!==e.statusText&&(this.addRequest=null,this.setState({adding:!1}))}))}componentDidMount(){this.fetchTerms()}componentWillUnmount(){(0,s.invoke)(this.fetchRequest,["abort"]),(0,s.invoke)(this.addRequest,["abort"])}componentDidUpdate(e){this.props.taxonomy!==e.taxonomy&&this.fetchTerms()}async fetchTerms(){const{taxonomy:e}=this.props;if(!e)return;const t=await this.fetchTermsRecursively(),r=this.sortBySelected(p(t));this.setState({loading:!1,availableTermsTree:r,availableTerms:t})}fetchTermsRecursively(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return r=r||this.getNewDeferredPromise(),this.fetchRequest=h()({path:(0,d.addQueryArgs)(`/wp/v2/${this.props.taxonomy.rest_base}`,{...f,page:t})}),this.fetchRequest.then((a=>{e=[...e,...a],a.length<f.per_page?(this.fetchRequest=null,r.resolve(e)):this.fetchTermsRecursively(e,t+1,r)}),(e=>{"abort"!==e.statusText&&(this.fetchRequest=null,this.setState({loading:!1}),r.reject(e))})),r.promise}getNewDeferredPromise(){let e,t;return{promise:new Promise(((r,a)=>{e=r,t=a})),resolve:e,reject:t}}sortBySelected(e){const{terms:t}=this.props,r=e=>-1!==t.indexOf(e.id)||void 0!==e.children&&!!(e.children.map(r).filter((e=>e)).length>0);return e.sort(((e,t)=>{const a=r(e),i=r(t);return a===i?0:a&&!i?-1:!a&&i?1:0})),e}setFilterValue(e){const{availableTermsTree:t}=this.state,r=e.target.value,a=t.map(this.getFilterMatcher(r)).filter((e=>e)),i=e=>{let t=0;for(let r=0;r<e.length;r++)t++,void 0!==e[r].children&&(t+=i(e[r].children));return t};this.setState({filterValue:r,filteredTermsTree:a});const s=i(a),n=(0,o.sprintf)(
/* translators: %d: number of results */
(0,o._n)("%d result found.","%d results found.",s),s);this.props.debouncedSpeak(n,"assertive")}getFilterMatcher(e){const t=r=>{if(""===e)return r;const a={...r};return a.children.length>0&&(a.children=a.children.map(t).filter((e=>e))),(-1!==a.name.toLowerCase().indexOf(e.toLowerCase())||a.children.length>0)&&a};return t}renderTerms(e){const{terms:t=[]}=this.props;return e.map((e=>(0,i.createElement)("div",{key:e.id,className:"editor-post-taxonomies__hierarchical-terms-choice"},(0,i.createElement)(n.CheckboxControl,{checked:-1!==t.indexOf(e.id),onChange:()=>{const t=parseInt(e.id,10);this.onChange(t)},label:(0,s.unescape)(e.name)}),!!e.children.length&&(0,i.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-subchoices"},this.renderTerms(e.children)))))}render(){const{slug:e,taxonomy:t,instanceId:r,hasCreateAction:l,hasAssignAction:m}=this.props;if(!m)return null;const{availableTermsTree:c,availableTerms:h,filteredTermsTree:d,formName:p,formDescription:u,formParent:g,loading:_,showForm:f,filterValue:b}=this.state,v=(r,a,i)=>(0,s.get)(t,["labels",r],"category"===e?a:i),w=v("add_new_item",(0,o.__)("Add new category"),(0,o.__)("Add new term")),x=v("new_item_name",(0,o.__)("Add new category"),(0,o.__)("Add new term")),T=v("parent_item",(0,o.__)("Parent Category"),(0,o.__)("Parent Term")),y=`— ${T} —`,C=w,F=`editor-post-taxonomies__hierarchical-terms-input-${r}`,E=`editor-post-taxonomies__hierarchical-terms-filter-${r}`,N=(0,s.get)(this.props.taxonomy,["labels","search_items"],(0,o.__)("Search Terms")),S=(0,s.get)(this.props.taxonomy,["name"],(0,o.__)("Terms")),P=h.length>=8,k=a[t.slug];return[P&&(0,i.createElement)("label",{key:"filter-label",htmlFor:E},N),P&&(0,i.createElement)("input",{type:"search",id:E,value:b,onChange:this.setFilterValue,className:"editor-post-taxonomies__hierarchical-terms-filter",key:"term-filter-input"}),(0,i.createElement)("div",{className:"editor-post-taxonomies__hierarchical-terms-list",key:"term-list",tabIndex:"0",role:"group","aria-label":S},this.renderTerms(""!==b?d:c)),!_&&l&&(0,i.createElement)(n.Button,{key:"term-add-button",onClick:this.onToggleForm,className:"editor-post-taxonomies__hierarchical-terms-add","aria-expanded":f,isLink:!0},w),f&&(0,i.createElement)(n.Modal,{key:"hierarchical-terms-form-modal",title:"Add New "+t.labels.singular_name,onRequestClose:this.onToggleForm},(0,i.createElement)("form",{onSubmit:this.onAddTerm,className:"hierarchical-terms-form"},(0,i.createElement)("label",{htmlFor:F,className:"editor-post-taxonomies__hierarchical-terms-label"},x),(0,i.createElement)("input",{type:"text",id:F,className:"editor-post-taxonomies__hierarchical-terms-input",value:p,onChange:this.onChangeFormName,required:!0}),(0,i.createElement)("label",{htmlFor:"editor-post-taxonomies__hierarchical-terms-description-"+r,className:"editor-post-taxonomies__hierarchical-terms-label"},"Description"),(0,i.createElement)("textarea",{id:"editor-post-taxonomies__hierarchical-terms-description-"+r,className:"editor-post-taxonomies__hierarchical-terms-input",value:u,onChange:this.onChangeFormDescription}),(0,i.createElement)(k,{ref:this.metaFields,onChange:this.onChangeFormMeta,instanceId:r,defaultValue:this.state.formMeta}),!!h.length&&t.hierarchical&&(0,i.createElement)(n.TreeSelect,{className:"wsu-custom-term-selector__tree-select",label:T,noOptionLabel:y,onChange:this.onChangeFormParent,selectedId:g,tree:c}),(0,i.createElement)(n.Button,{isSecondary:!0,type:"submit",className:"editor-post-taxonomies__hierarchical-terms-submit wsu-custom-term-selector__hierarchical-terms-submit"},C)))]}}const v=(0,m.compose)([(0,l.withSelect)(((e,t)=>{let{slug:r}=t;const{getCurrentPost:a}=e("core/editor"),{getTaxonomy:i}=e("core"),o=i(r);return{hasCreateAction:!!o&&(0,s.get)(a(),["_links","wp:action-create-"+o.rest_base],!1),hasAssignAction:!!o&&(0,s.get)(a(),["_links","wp:action-assign-"+o.rest_base],!1),terms:o?e("core/editor").getEditedPostAttribute(o.rest_base):[],taxonomy:o}})),(0,l.withDispatch)((e=>({onUpdateTerms(t,r){e("core/editor").editPost({[r]:t})}}))),n.withSpokenMessages,m.withInstanceId])(b);wp.hooks.addFilter("editor.PostTaxonomyType","wsuwp-plugin-news",(function(e){const t=["media_contact","author"];return function(r){return t.includes(r.slug)?(0,i.createElement)(v,r):(0,i.createElement)(e,r)}}))}},r={};function a(e){var i=r[e];if(void 0!==i)return i.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,r,i,s)=>{if(!r){var o=1/0;for(c=0;c<e.length;c++){for(var[r,i,s]=e[c],n=!0,l=0;l<r.length;l++)(!1&s||o>=s)&&Object.keys(a.O).every((e=>a.O[e](r[l])))?r.splice(l--,1):(n=!1,s<o&&(o=s));if(n){e.splice(c--,1);var m=i();void 0!==m&&(t=m)}}return t}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[r,i,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={826:0,431:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var i,s,[o,n,l]=r,m=0;if(o.some((t=>0!==e[t]))){for(i in n)a.o(n,i)&&(a.m[i]=n[i]);if(l)var c=l(a)}for(t&&t(r);m<o.length;m++)s=o[m],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(c)},r=globalThis.webpackChunkwsuwp_plugin_news=globalThis.webpackChunkwsuwp_plugin_news||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var i=a.O(void 0,[431],(()=>a(28)));i=a.O(i)})();